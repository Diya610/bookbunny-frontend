<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookBunny ğŸ“šğŸ°</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<button id="logoutBtn" class="logout">Logout</button>
<button id="themeToggle" class="theme-btn">ğŸŒ™</button>

<div class="container">
  <h1 id="welcomeTitle">Hi Reader ğŸ°</h1>
  <p>Your cozy corner for book lovers ğŸ’•</p>

  <!-- âœ… Search Bar -->
  <input type="text" id="searchInput" placeholder="Search for any bookâ€¦">
  <button id="searchBtn" class="main-btn">Search ğŸ”</button>
  <ul id="searchResults"></ul>

  <hr class="divider">

  <!-- âœ… Recommendations -->
  <button id="loadBooks" class="main-btn">Show Recommended Books âœ¨</button>
  <ul id="bookList"></ul>
</div>

<script>
console.log("âœ… Home script loaded");

const apiUrl = "https://bookbunny-backend.onrender.com";

// âœ… Username Greeting
const user = localStorage.getItem("username");
if (!user) {
  window.location.href = "login.html";
} else {
  document.getElementById("welcomeTitle").textContent = `Hi ${user} ğŸ°`;
}

// âœ… Logout
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("username");
  window.location.href = "login.html";
});

// âœ… Theme Toggle
const btnTheme = document.getElementById("themeToggle");
if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
  btnTheme.textContent = "â˜€ï¸";
}
btnTheme.addEventListener("click",()=>{
  const dark=document.body.classList.toggle("dark");
  btnTheme.textContent = dark ? "â˜€ï¸" : "ğŸŒ™";
  localStorage.setItem("theme", dark ? "dark" : "light");
});

// âœ… Recommendations
document.getElementById("loadBooks").addEventListener("click", async () => {
  const res = await fetch(`${apiUrl}/books`);
  const books = await res.json();
  const list = document.getElementById("bookList");
  list.innerHTML = "";
  books.forEach(book => {
    list.innerHTML += `
      <li class="book-card">
        <h3>${book.title}</h3>
        <p><strong>Author:</strong> ${book.author}</p>
        <p><strong>Genre:</strong> ${book.genre}</p>
      </li>
    `;
  });
});

// âœ… GLOBAL SEARCH â€” FINAL
document.getElementById("searchBtn").addEventListener("click", async () => {
  const query = document.getElementById("searchInput").value.trim();
  if (!query) return;

  const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}`);
  const data = await res.json();

  const list = document.getElementById("searchResults");
  list.innerHTML = "";

  if (!data.items) {
    list.innerHTML = "<p>No results found ğŸ˜¢</p>";
    return;
  }

  data.items.forEach(book => {
    const info = book.volumeInfo;
    const goodreadsQuery = encodeURIComponent(info.title + " " + (info.authors?.[0] || ""));

    list.innerHTML += `
      <li class="book-card">
        <img src="${info.imageLinks?.thumbnail || ''}" class="book-img">
        <h3>${info.title}</h3>
        <p><strong>Author:</strong> ${info.authors?.join(", ") || "Unknown"}</p>
        <p><strong>Published:</strong> ${info.publishedDate || "N/A"}</p>
        <p><strong>Pages:</strong> ${info.pageCount || "N/A"}</p>

        <label><strong>Your Rating:</strong></label>
        <input type="number" min="0" max="5" step="0.25" class="ratingInput" placeholder="0â€“5"> â­

        <button class="favBtn">â¤ï¸ Add to Favorites</button>
        <button class="reviewBtn">âœ Add Review</button>

        <a href="https://www.goodreads.com/search?q=${goodreadsQuery}" target="_blank" class="goodreads-btn">
          View on Goodreads ğŸ”—
        </a>
      </li>
    `;
  });
});
</script>

</body>
</html>
