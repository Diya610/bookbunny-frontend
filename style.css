<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookBunny 📚🐰</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<button id="logoutBtn" class="logout">Logout</button>
<button id="themeToggle" class="theme-btn">🌙</button>

<div class="container">
  <h1 id="welcomeTitle">Hi Reader 🐰</h1>
  <p>Your cozy corner for book lovers 💕</p>

  <!-- ✅ SEARCH SECTION -->
  <input type="text" id="searchInput" placeholder="Search for any book in the world...">
  <button id="searchBtn" class="main-btn">Search 🔍</button>
  <ul id="searchResults"></ul>

  <hr class="divider">

  <!-- ✅ RECOMMEND SECTION -->
  <button id="loadBooks" class="main-btn">Show Recommended Books ✨</button>
  <ul id="bookList"></ul>
</div>

<script>
console.log("✅ Home script loaded");

const apiUrl = "https://bookbunny-backend.onrender.com";

/* ✅ Personalized Greeting */
const user = localStorage.getItem("username");
if (!user) {
  window.location.href = "login.html";
} else {
  document.getElementById("welcomeTitle").textContent = `Hi ${user} 🐰`;
}

/* ✅ Logout */
document.getElementById("logoutBtn").addEventListener("click", () => {
  localStorage.removeItem("username");
  window.location.href = "login.html";
});

/* ✅ Theme Toggle */
const btnTheme = document.getElementById("themeToggle");
if(localStorage.getItem("theme")==="dark"){
  document.body.classList.add("dark");
  btnTheme.textContent = "☀️";
}
btnTheme.addEventListener("click", ()=>{
  const dark = document.body.classList.toggle("dark");
  btnTheme.textContent = dark ? "☀️" : "🌙";
  localStorage.setItem("theme", dark ? "dark" : "light");
});

/* ✅ Recommended Books */
document.getElementById("loadBooks").addEventListener("click", async () => {
  const res = await fetch(`${apiUrl}/books`);
  const books = await res.json();

  const list = document.getElementById("bookList");
  list.innerHTML = "";
  books.forEach(book => {
    const item = document.createElement("li");
    item.classList.add("book-card");
    item.innerHTML = `
      <h3>${book.title}</h3>
      <p><strong>Author:</strong> ${book.author}</p>
      <p><strong>Genre:</strong> ${book.genre}</p>
    `;
    list.appendChild(item);
  });
});

/* ✅ GLOBAL BOOK SEARCH */
document.getElementById("searchBtn").addEventListener("click", async () => {
  const query = document.getElementById("searchInput").value;
  if (!query) return;

  const res = await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}`);
  const data = await res.json();

  const list = document.getElementById("searchResults");
  list.innerHTML = "";

  if (!data.items) {
    list.innerHTML = "<p>No results found 😢</p>";
    return;
  }

  data.items.forEach(book => {
    const info = book.volumeInfo;
    const item = document.createElement("li");
    item.classList.add("book-card");
    item.innerHTML = `
      <img src="${info.imageLinks?.thumbnail || ''}" class="book-img">
      <h3>${info.title}</h3>
      <p><strong>Author:</strong> ${info.authors?.join(", ") || "Unknown"}</p>
      <p><strong>Published:</strong> ${info.publishedDate || "N/A"}</p>
      <p><strong>Pages:</strong> ${info.pageCount || "N/A"}</p>
      <p><strong>Series:</strong> ${info.seriesInfo?.title || "Not part of series"}</p>
    `;
    list.appendChild(item);
  });
});
</script>

</body>
</html>
